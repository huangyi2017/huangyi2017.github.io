# 一条查询SQL如何执行
## 前言
在执行一条查询语句时，我们看到的只是输入一条语句，返回一个结果，却不知道这条语句在 MySQL 内部的执行过程。
所以今天我想和你一起把 MySQL 拆解一下，看看里面都有哪些 “零件” ， 希望借由这个 拆解过程，让你对 MySQL 有更深入的理解。


下面我给出的是 MySQL 的基本架构示意图，从中你可以清楚地看到 SQL 语句在 MySQL的各个功能模块中的执行过程。

![img.png](img/mysql.png)


- 大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。
Server 层包括连接器、 查询缓存、 分析器、 优化器、 执行器等，涵盖 MySQL 的大多数核 心服务功能，
所有跨存储引擎 的功能都在这一层实现，比如存储过程、触发器、视图等。

- 存储引擎层负责数据的存储和提取。 其架构模式是插件式的，支持 InnoDB、 MyISAM、 Memory 等多个存储引擎。

## Server 层
不同的存储引擎共用一个**Server**层 ， 也就是从连接器到执行器的部分。 你可以先对每个组件的名字有个印象，接下来我会结合开头提到的那条 SQL 语句，
带你走一遍整个执行流程，依次看下每个组件的作用。

### 连接器
第一步，你会先连接到这个数据库上，这时候接待你的就是连接器。连接器负责跟客户端建 立连接、 获取权限、 维持和管理连接

### 查询缓存
连接建立完成后，你就可以执行select语句了。 执行逻辑就会来到第二步：查询缓存。
MySQL 拿到一个查询请求后，会先到查询缓存看看，之前是不是执行过这条语句。 之前执 行过的语句及其结果可能会以**key-value**对的形式，
被直接缓存在内存中。 key是查询的语句value是查询的结果。如果你的查询能够直接在这个缓存中找到key，那么这个value就会被直接返回给客户端。
如果语句不在查询缓存中，就会继续后面的执行阶段。 执行完成后，执行结果会被存入查询 缓存中。

### 分析器
如果没有命中查询缓存，就要开始真正执行语句了。 首先，MySQL 需要知道你要做什么， 因此需要对 SQL 语句做解析。
分析器先会做“词法分析”,MySQL 从你输入的"select"这个关键字识别出来，这是一个查询语句。
它也要把字符 串 “T” 识别成“表名 T” ， 把字符串“ID” 识别成“列 ID”

### 优化器
经过了分析器，MySQL 就知道你要做什么了。 在开始执行之前，还要先经过优化器的处理。
优化器是在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联的时候，决定各个表的连接顺序。

### 执行器
优化器阶段完成后，这个语句的执行方案就确定下来了，然后进入执行器阶段，开始执行语句。

#### 执行流程
- 1：调用 InnoDB 引擎接口取这个表的第一行，判断 ID 值是不是 10，如果不是则跳过，如
果是则将这行存在结果集中
- 2:调用引擎接口取`下一行`，重复相同的判断逻辑，直到取到这个表的最后一行。
- 3:执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。



